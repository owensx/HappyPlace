{% load filters %}
{% load staticfiles %}
    				
<html xmlns="http://www.w3.org/1999/xhtml">

<link rel="stylesheet" href="{% static 'main.css' %}" type="text/css">

<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
    <script src='https://maps.googleapis.com/maps/api/js?v=3.exp'></script>
    
    <script type="text/javascript">  
        $(document).ready(function(){
			$('#submit').attr('disabled', true);
            $("#report tr:odd").addClass("odd");
            $("#report tr:even").addClass("hidden");
            $("#report tr:not(.odd)").hide();
            $("#report tr:first-child").show();
            
            $("#report tr.odd").click(function(){
                $(this).next("tr").toggle();
                $(this).find(".arrow").toggleClass("up");
            });
            	
            $("select#city").change(function() {
				if ($(this).val() == 'Z') {
					$("select#neighborhood").html("<option>Select a model</option>");
					$("select#neighborhood").attr('disabled', true);
				} else {
					var url = "/getNeighborhoods/" + $(this).val();
					$.getJSON(url, function(data) {
						var options = '<option value="all">All Neighborhoods</option>';
						for (var i = 0; i < data.length; i++) {
							options += '<option value="' + data[i] + '">' + data[i] + '</option>';
						}
						$("select#neighborhood").html(options);
						$("select#neighborhood option:first").attr('selected', 'selected');
						$("select#neighborhood").attr('disabled', false);
					});
					
					$('#submit').attr('disabled', false);
				}
       	 	});
       	 });

	</script>
</head>

<form enctype="multipart/form-data" action="/" method="post">
	{% csrf_token %}
	
	<select name="city" id="city">
		<option value="Z">Select a City</option>
		{% for city in cities %}
			<option value="{{ city }}">{{ city }}</option>
		{% endfor %}
	</select>
	
	<select name="neighborhood" id="neighborhood" disabled="true">
		<option>Select a Neighborhood</option>
	</select>
	
	<input id="submit" type="submit" value="Submit">
</form>

<body>
<div id = "tableContainer" cellspacing='0' >
 <table id="report">
        <tr>
            <th>Name</th>
    		<th>Neighborhood</th>
    		<th colspan=2>Location</th>
            <th colspan=2>Today's Specials</th>
            <th></th>
        </tr>
        {% for happyPlace in happyPlaces %}
{#        	 {% if happyPlace.active %} 		#}
	        	<tr>
	            	<td>{{ happyPlace.name }}</td>
	            	<td>{{ happyPlace.neighborhood }}</td>
		            <td colspan=2> 
{#		            	{% if happyPlace.latitude != 0	 and happyPlace.longitude != 0 %}#}
{#		            		<a href="https://www.google.com/maps/dir//{{ happyPlace.latitude }},{{ happyPlace.longitude }}/@{{ happyPlace.latitude }},{{ happyPlace.longitude }},17z">#}
{#		            			{{ happyPlace.address }}#}
{#		            		</a>#}
{#		            		</br>@</br>#}
{#		            		{{ happyPlace.cross }}#}
{#		            	{% else %}	#}
		            		<a href="https://www.google.com/maps/place/{{happyPlace.name}} {{ happyPlace.address }} {{ happyPlace.city }}/17z">
		            			{{ happyPlace.address }}
		            		</a>
		            		</br>@</br>
		            		{{ happyPlace.cross }}
{#		            	{% endif %}#}
		            </td>
		            <td colspan=2>
		            	{% for happyHour in happyPlace.happyhour_set.all %}
		            		{% if today in happyHour.days %}
		            			<span>
		            			{{happyHour.start|formatStart}} - {{happyHour.end|formatEnd}}: {{ happyHour.notes }}</br>
		            			</span>		            		
		            		{% endif %}
		        		{% endfor %}
		            </td>
		            <td><div class="arrow"></div></td>
		        </tr>
		        
		        <tr>
		        {% for dayPair in dayPairs %}
		        	<td class="dayOfWeek">
		        		<p><strong>{{ dayPair.0 }}</strong></p>
		        		</br>
		        		</br>
		        		<p>
		        		{% for happyHour in happyPlace.happyhour_set.all %}
		        			{% if dayPair.0 in happyHour.days %}        			
		        				{{ happyHour.start|formatStart }} - {{ happyHour.end|formatEnd }}
		        				</br>
		        				{{ happyHour.notes }}        			
		        				</br></br>     			 
		        			{% endif %}
		        		{% endfor %}
		        		</p>
		        	</td>
		        {% endfor %}			        	
		        </tr>
			{# {% endif %} #}
       	{% endfor %} 
    </table>
</div>
<a href="submit/"> Tell us your HappyPlace </a>
</body>
</html>